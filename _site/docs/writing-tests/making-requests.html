<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
 <link href="/assets/prism.css" rel="stylesheet" />

  <link rel="stylesheet" href="/assets/common.css">

  <title>Inferno Framework - Making Requests</title>
<body  data-spy="scroll" data-target="#toc">
  <nav class="header-nav navbar navbar-expand-lg navbar-light navbar-custom">
    <div class="container-fluid">
      <a class="navbar-brand" href="/index_new.html">
        <img src="/assets/icon_logo.png" alt="Logo" width="46px" height="50px">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="search-container">
          <div class="input-group">
            <span class="input-group-text bg-white border-right-0 text-muted" id="search-addon">
              <i class="fas fa-search"></i>
            </span>
            <input type="search" class="form-control border-left-0 pl-0 shadow-none" placeholder="Search Inferno Documentation" aria-label="Search" aria-describedby="search-addon" id="search-input">
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link align-middle" style="display: inline" href="/about/">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/docs">Documentation</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/community">Community</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/news">News</a>
          </li>
        </ul>
        <a href="https://github.com/inferno-framework" target="_blank" rel="noopener noreferrer" class="ms-2 d-flex align-items-center" style="text-decoration:none">
          <i class="fab fa-github fa-lg"></i>
      </a>
      </div>
    </div>
  </nav>




  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

<div class="container-fluid docs-content">
  <div class="row breadcrumbs-row d-none d-lg-flex">
    <div class="col-lg-3 left-nav-column">
    </div>
    <div class="col-lg-7">
      <div class="docs-body mx-auto">
      
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-white">
        <li class="breadcrumb-item"><a href="/index_new.html"><span>Home</span></a></li>
        
          
            <li class="breadcrumb-item"><a href="/docs/"><span>Documentation</span></a></li>
            <li class="breadcrumb-item active">Making Requests</li>
          
        
        
        
        
      </ol>
    </nav>


      </div>
     
    </div>
    <div class="col-lg-2"></div>
    
  </div>
  <div class="row">
    <div class="col-lg-3 left-nav-column">
      <div class="d-none d-lg-block">
      <nav id="sidebar">
    <ul class="navbar-nav list-unstyled components"><li class="nav-item"><div class="nav-group">Documentation</div></li><li class="nav-item"><a href="/docs/" class="nav-link-top nav-link">Introduction</a></li><li class="nav-item"><a href="/docs/concepts.html" class="nav-link-top nav-link">Key Concepts</a></li><li class="nav-item"><div class="nav-group">Creating Test Kits</div></li><li class="nav-item"><button href="#" class="btn btn-link nav-list-expander" aria-label="toggle links in Getting Started category">
                <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg>
            </button><a href="/docs/getting-started/" class="nav-link-top nav-link">Getting Started</a><ul class="collapse list-unstyled"><li class=""><a href="/docs/getting-started/repo-layout-and-organization.html" class="nav-link">Template Layout</a></li><li class=""><a href="/docs/getting-started/inferno-cli.html" class="nav-link">Inferno CLI</a></li><li class=""><a href="/docs/getting-started/debugging.html" class="nav-link">Debugging</a></li></ul></li><li class="nav-item active"><button href="#" class="btn btn-link nav-list-expander" aria-label="toggle links in Writing Tests category">
                <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg>
            </button><a href="/docs/writing-tests/" class="nav-link-top nav-link">Writing Tests</a><ul class="list-unstyled"><li class=""><a href="/docs/writing-tests/properties.html" class="nav-link">Properties</a></li><li class=""><a href="/docs/writing-tests/test-inputs-outputs.html" class="nav-link">Inputs and Outputs</a></li><li class=" active"><a href="/docs/writing-tests/making-requests.html" class="nav-link active">Making Requests</a></li><li class=""><a href="/docs/writing-tests/assertions-and-results.html" class="nav-link">Test Assertions and Results</a></li><li class=""><a href="/docs/writing-tests/fhir-validation.html" class="nav-link">FHIR Validation</a></li></ul></li><li class="nav-item"><button href="#" class="btn btn-link nav-list-expander" aria-label="toggle links in Advanced Features category">
                <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg>
            </button><a href="/docs/advanced-test-features/" class="nav-link-top nav-link">Advanced Features</a><ul class="collapse list-unstyled"><li class=""><a href="/docs/advanced-test-features/test-configuration.html" class="nav-link">Altering Test Behavior</a></li><li class=""><a href="/docs/advanced-test-features/serving-http-requests.html" class="nav-link">Serving HTTP Requests</a></li><li class=""><a href="/docs/advanced-test-features/waiting-for-requests.html" class="nav-link">Waiting for Incoming Request</a></li><li class=""><a href="/docs/advanced-test-features/scratch.html" class="nav-link">Scratch</a></li><li class=""><a href="/docs/advanced-test-features/configuration-checks.html" class="nav-link">Configuration Checks</a></li></ul></li><li class="nav-item"><a href="/docs/distributing-tests.html" class="nav-link-top nav-link">Distributing Tests</a></li><li class="nav-item"><a href="/docs/ruby.html" class="nav-link-top nav-link">Inferno Ruby API</a></li><li class="nav-item"><div class="nav-group">Using Test Kits</div></li><li class="nav-item"><a href="/docs/getting-started-users.html" class="nav-link-top nav-link">Getting Started</a></li><li class="nav-item"><button href="#" class="btn btn-link nav-list-expander" aria-label="toggle links in Deploying to Shared Hosts category">
                <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg>
            </button><a href="/docs/deployment/" class="nav-link-top nav-link">Deploying to Shared Hosts</a><ul class="collapse list-unstyled"><li class=""><a href="/docs/deployment/security.html" class="nav-link">Security Considerations</a></li><li class=""><a href="/docs/deployment/database.html" class="nav-link">Database Configuration</a></li><li class=""><a href="/docs/deployment/ssl.html" class="nav-link">SSL Configuration</a></li><li class=""><a href="/docs/deployment/host.html" class="nav-link">Hostname and Path Configuration</a></li><li class=""><a href="/docs/deployment/input-presets.html" class="nav-link">Input Presets</a></li></ul></li><li class="nav-item"><a href="/docs/json-api/" class="nav-link-top nav-link">JSON API</a></li></ul></nav>
      </div>
    </div>
    <div class="col-lg-7">
      <div class="docs-body mx-auto">
      <h1 id="making-requests">Making Requests</h1>
<p>Inferno provides support for making FHIR requests as well as generic HTTP requests.</p>

<h3 id="accessing-requests-and-responses">Accessing Requests and Responses</h3>
<p>After making a FHIR or HTTP request, information about it is made available via several
methods:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">request</code> - returns a
<a href="/inferno-core/docs/Inferno/Entities/Request.html"><code class="language-plaintext highlighter-rouge">Request</code></a> object which
contains all of the information about the request and the response.</li>
  <li><code class="language-plaintext highlighter-rouge">response</code> - returns a Hash containing the <code class="language-plaintext highlighter-rouge">status</code>, <code class="language-plaintext highlighter-rouge">headers</code>, and <code class="language-plaintext highlighter-rouge">body</code> of
the response.</li>
  <li><code class="language-plaintext highlighter-rouge">resource</code> - returns the response body as a FHIR model.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">test</span> <span class="k">do</span>
  <span class="n">run</span> <span class="k">do</span>
    <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">)</span>
    
    <span class="n">request</span>  <span class="c1"># A `Request` object containing the request and response</span>
    <span class="n">response</span> <span class="c1"># A `Hash` containing the response information</span>
    <span class="n">resource</span> <span class="c1"># A FHIR model built from the response body</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When making <a href="/inferno-core/docs/Inferno/DSL/Assertions.html">assertions</a> against
a response or resource, the assertions that are designed to be used with
responses and resources will automatically use the response/resource from the
last request. It is therefore unnecessary to pass the response/resource in to the assertion
unless you want to make assertions against a different response/resource.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">test</span> <span class="k">do</span>
  <span class="n">run</span> <span class="k">do</span>
    <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">)</span>
    
    <span class="c1"># Using the values from the fhir_read request automatically</span>
    <span class="n">assert_response_status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">assert_resource_type</span><span class="p">(</span><span class="ss">:patient</span><span class="p">)</span>
    <span class="n">assert_valid_resource</span>
    
    <span class="o">...</span>
    
    <span class="c1"># Specifying the request &amp; resource explicitly</span>
    <span class="n">assert_response_status</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="ss">request: </span><span class="n">some_other_request</span><span class="p">)</span>
    <span class="n">assert_resource_type</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="ss">resource: </span><span class="n">some_other_resource</span><span class="p">)</span>
    <span class="n">assert_valid_resource</span><span class="p">(</span><span class="ss">resource: </span><span class="n">some_other_resource</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="reusing-requests">Reusing Requests</h3>
<p>If you want to reuse a request from an earlier test instead of reissuing it,
you can give the initial request a name, and then have your other tests use that named request.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="nb">test</span> <span class="k">do</span>
    <span class="c1"># Declare that this test makes a particular request</span>
    <span class="n">makes_request</span> <span class="ss">:patient_read</span>
    
    <span class="n">run</span> <span class="k">do</span>
      <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">,</span> <span class="ss">name: :patient_read</span><span class="p">)</span> <span class="c1"># include the name</span>
    <span class="k">end</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="k">do</span>
    <span class="c1"># Declare that this test uses the named request ":patient_read". The test runner</span>
    <span class="c1"># will automatically load this request and make it available within the test.</span>
    <span class="n">uses_request</span> <span class="ss">:patient_read</span>
    
    <span class="n">run</span> <span class="k">do</span>
      <span class="c1"># These will all be populated with the request from the first test</span>
      <span class="n">request</span>
      <span class="n">response</span>
      <span class="n">resource</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="fhir-requests">FHIR Requests</h2>

<h4 id="fhir-clients">FHIR Clients</h4>
<p>Before making a FHIR request, a client needs to be created. Clients are passed
down from a <code class="language-plaintext highlighter-rouge">TestSuite</code> or <code class="language-plaintext highlighter-rouge">TestGroup</code> to all of their descendants, so it isn’t
necessary for each <code class="language-plaintext highlighter-rouge">Test</code> to define its own client. When defining a client, you
MUST set the base server url, and you MAY set a bearer token and additional
custom headers.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="n">fhir_client</span> <span class="k">do</span>
    <span class="n">url</span> <span class="s1">'https://example.com/fhir'</span>   <span class="c1"># required</span>
    <span class="n">bearer_token</span> <span class="s1">'abc'</span>               <span class="c1"># optional</span>
    <span class="n">headers</span> <span class="s1">'X-Custom-Header'</span> <span class="o">=&gt;</span> <span class="s1">'def'</span> <span class="c1"># optional</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="k">do</span>
    <span class="n">run</span> <span class="k">do</span>
      <span class="c1"># FHIR requests will automatically use the client declared above</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It is unlikely you will want to hard code the server url or bearer token, so a Ruby
symbol can be used to read these values from an input.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="n">input</span> <span class="ss">:server_url</span><span class="p">,</span> <span class="ss">:access_token</span>
  
  <span class="n">fhir_client</span> <span class="k">do</span>
    <span class="n">url</span> <span class="ss">:server_url</span>
    <span class="n">bearer_token</span> <span class="ss">:access_token</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you need direct access to the FHIR client in a test, it is available via
<code class="language-plaintext highlighter-rouge">fhir_client</code>. The client is reinstantiated in each test, so changes made to a
client within a test do not carry over into other tests.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">test</span> <span class="k">do</span>
  <span class="n">run</span> <span class="k">do</span>
    <span class="n">fhir_client</span> <span class="c1"># this returns the FHIR client</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p><a href="/inferno-core/docs/Inferno/DSL/FHIRClientBuilder.html">methods for defining FHIR clients in the API docs</a></p>

<h4 id="available-fhir-request-methods">Available FHIR Request Methods</h4>
<p>The following methods are currently available for making FHIR requests:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">fhir_create</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_delete</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_get_capability_statement</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_operation</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_read</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_search</code></li>
  <li><code class="language-plaintext highlighter-rouge">fhir_transaction</code></li>
</ul>

<p>For more details on these methods, see the <a href="/inferno-core/docs/Inferno/DSL/FHIRClient.html">FHIR Client API
documentation</a>. If you need to
make other types of FHIR requests, <a href="/about/who.html">contact the Inferno
team</a> so we can prioritize adding them.</p>

<p>Here are some examples of how to use the above methods:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">test</span> <span class="k">do</span>
  <span class="c1"># Create a resource on a server</span>
  <span class="n">new_patient</span> <span class="o">=</span> <span class="no">FHIR</span><span class="o">::</span><span class="no">Patient</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="p">[{</span> <span class="ss">given: </span><span class="p">[</span><span class="s1">'Jane'</span><span class="p">],</span> <span class="ss">family: </span><span class="s1">'Doe'</span><span class="p">}])</span>
  <span class="n">fhir_create</span><span class="p">(</span><span class="n">new_patient</span><span class="p">)</span>
  
  <span class="c1"># Delete a resource on a server</span>
  <span class="n">fhir_delete</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'resource_to_delete_id_1'</span><span class="p">)</span>
  <span class="n">fhir_delete</span><span class="p">(</span><span class="s1">'Patient'</span><span class="p">,</span> <span class="s1">'resource_to_delete_id_2'</span><span class="p">)</span>
  
  <span class="c1"># Fetch a server's CapabilityStatement</span>
  <span class="n">fhir_get_capability_statement</span>
  
  <span class="c1"># Perform a FHIR Operation</span>
  <span class="n">parameters</span> <span class="o">=</span> <span class="no">FHIR</span><span class="o">::</span><span class="no">Parameters</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="ss">parameter: </span><span class="p">[</span>
      <span class="p">{</span>
        <span class="ss">name: </span><span class="s1">'code'</span><span class="p">,</span>
        <span class="ss">valueCode: </span><span class="s1">'85354-9'</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="ss">name: </span><span class="s1">'system'</span>
        <span class="ss">valueUri: </span><span class="s1">'http://loinc.org'</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">)</span>
  <span class="n">fhir_operation</span><span class="p">(</span><span class="s2">"/CodeSystem/$lookup"</span><span class="p">,</span> <span class="ss">body: </span><span class="n">parameters</span><span class="p">)</span>
  
  <span class="c1"># Read a FHIR resource</span>
  <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'resource_to_read_id'</span><span class="p">)</span>
  <span class="n">fhir_read</span><span class="p">(</span><span class="s1">'Patient'</span><span class="p">,</span> <span class="s1">'resource_to_read_id'</span><span class="p">)</span>
  
  <span class="c1"># Perform a FHIR search w/GET</span>
  <span class="n">fhir_search</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span> <span class="ss">family: </span><span class="s1">'Smith'</span> <span class="p">})</span>
  <span class="n">fhir_search</span><span class="p">(</span><span class="s1">'Patient'</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span> <span class="ss">family: </span><span class="s1">'Smith'</span> <span class="p">})</span>
  
  <span class="c1"># Perform a FHIR search w/POST</span>
  <span class="n">fhir_search</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span> <span class="ss">family: </span><span class="s1">'Smith'</span> <span class="p">},</span> <span class="ss">search_method: :post</span><span class="p">)</span>
  <span class="n">fhir_search</span><span class="p">(</span><span class="s1">'Patient'</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span> <span class="ss">family: </span><span class="s1">'Smith'</span> <span class="p">},</span> <span class="ss">search_method: :post</span><span class="p">)</span>
  
  <span class="c1"># Perform a FHIR transaction</span>
  <span class="n">transaction_bundle</span> <span class="o">=</span> <span class="no">FHIR</span><span class="o">::</span><span class="no">Bundle</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="ss">type: </span><span class="s1">'transaction'</span><span class="p">,</span>
    <span class="ss">entry: </span><span class="p">[</span>
      <span class="c1"># a list of transaction entries</span>
    <span class="p">]</span>
  <span class="p">)</span>
  <span class="n">fhir_transaction</span><span class="p">(</span><span class="n">transaction_bundle</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="making-requests-to-multiple-servers">Making Requests to Multiple Servers</h4>
<p>If you need to make requests to multiple FHIR servers, this can be accomplished
by naming each <code class="language-plaintext highlighter-rouge">fhir_client</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="n">fhir_client</span> <span class="ss">:client_a</span> <span class="k">do</span>
    <span class="n">url</span> <span class="ss">:url_a</span>
  <span class="k">end</span>
  
  <span class="n">fhir_client</span> <span class="ss">:client_b</span> <span class="k">do</span>
    <span class="n">url</span> <span class="ss">:url_b</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="k">do</span>
    <span class="n">run</span> <span class="k">do</span>
      <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">,</span> <span class="ss">client: :client_a</span><span class="p">)</span>
      
      <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'456'</span><span class="p">,</span> <span class="ss">client: :client_b</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h4 id="oauth-credentials">OAuth Credentials</h4>
<p>When making requests to FHIR servers using OAuth2-based authorization (such as the SMART App
Launch workflow), OAuth credentials support an access token and,
optionally, a refresh token and the information needed to perform a
token refresh (refresh token, token endpoint, client ID, client secret). If all
of this information is available, the FHIR client will automatically refresh the
access token if it will expire in under a minute. If no information on the
access token duration is available, the token will be refreshed prior to each
FHIR request.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="n">input</span> <span class="ss">:credentials</span><span class="p">,</span> <span class="ss">type: :oauth_credentials</span>
  
  <span class="n">fhir_client</span> <span class="k">do</span>
    <span class="n">url</span> <span class="s1">'https://example.com/fhir'</span>
    <span class="n">oauth_credentials</span> <span class="ss">:credentials</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="k">do</span>
    <span class="n">run</span> <span class="k">do</span>
      <span class="nb">sleep</span> <span class="mi">3600</span>
      
      <span class="c1"># The access token will automatically refresh if it has expired</span>
      <span class="n">fhir_read</span><span class="p">(</span><span class="ss">:patient</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">)</span> 
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="http-requests">HTTP Requests</h2>

<h4 id="http-clients">HTTP Clients</h4>
<p>It is not necessary to create a HTTP client in order to make HTTP requests, but
it may be helpful if you need to make multiple requests to the same server. If
an HTTP client is available, then the HTTP request methods only need
the relative path from the client’s url rather than an
absolute url. The syntax for doing so is the same as that for <a href="#fhir-clients">FHIR
clients</a>, except the method is called <code class="language-plaintext highlighter-rouge">http_client</code> rather than
<code class="language-plaintext highlighter-rouge">fhir_client</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="k">do</span>
  <span class="n">http_client</span> <span class="k">do</span>
    <span class="n">url</span> <span class="s1">'https://example.com'</span>
    <span class="n">bearer_token</span> <span class="s1">'abc'</span>
    <span class="n">headers</span> <span class="s1">'X-Custom-Header'</span> <span class="o">=&gt;</span> <span class="s1">'def'</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="k">do</span>
    <span class="n">run</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">'/path'</span>  <span class="c1"># Makes a request to `https://example.com/path`</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<h4 id="available-http-request-methods">Available HTTP Request Methods</h4>
<p>The following methods are currently available for making HTTP requests:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">get</code></li>
  <li><code class="language-plaintext highlighter-rouge">post</code></li>
  <li><code class="language-plaintext highlighter-rouge">delete</code></li>
  <li><code class="language-plaintext highlighter-rouge">stream</code> - used to stream the response from a GET request</li>
</ul>

<p>For more details on these methods, see the <a href="/inferno-core/docs/Inferno/DSL/HTTPClient.html">HTTP Client API
documentation</a>. If you need to
make other types of HTTP requests, <a href="/about/who.html">contact the Inferno
team</a> so we can prioritize adding them.</p>

      </div>
    </div>
    <div class="col-lg-2">
      <div class="right-toc sticky-top">
        <h5><a href="#">On this page</a></h5>
        <nav id="toc" data-toggle="toc"></nav>
      </div>
    </div>
  </div>
</div>


    <footer class="footer py-4 mt-4">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-6">
        <p></p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline text-md-right">
          <li class="list-inline-item"><a href="#">aaa</a></li>
          <li class="list-inline-item"><a href="#">aaa</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

<div class="search-overlay"></div>



    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
    <script src="/assets/common.js"></script>
    <script src="/assets/prism.js"></script>


  </body>
</html>